@model IEnumerable<Modelos_AutomaG.Aspirantes>
@{
    ViewData["Title"] = "Registro de Aspirantes";
}

<link rel="stylesheet" href="~/css/aspirantes-lista.css" asp-append-version="true" />

<div class="container-fluid" style="padding: 2rem;">

    <div class="page-heading">
        <h1 class="page-title">Registro de Aspirantes</h1>
        <p class="page-subtitle">Gestione y consulte la información de todos los aspirantes a programas de posgrado</p>
    </div>

    <div class="filters-card">
        <div class="filter-row">

            <div class="search-container">
                <i data-lucide="search" class="input-icon"></i>
                <input type="text" id="filtroTexto" class="custom-input" placeholder="Buscar por nombre, ciudad o programa...">
            </div>

            <div class="select-container">
                <i data-lucide="filter" class="input-icon"></i>
                <select id="filtroCampo" class="custom-select">
                    <option value="">Todas las categorías</option>
                    @if (ViewBag.Programas != null)
                    {
                        foreach (var prog in ViewBag.Programas)
                        {
                            <option value="@prog.nombrepro">@prog.nombrepro</option>
                        }
                    }
                </select>
            </div>
            <div class="select-container">
                <i data-lucide="check-circle" class="input-icon"></i>
                <select id="filtroEstado" class="custom-select">
                    <option value="">Todos los estados</option>
                    <option value="en revisión">En revisión</option>
                    <option value="revisado">Revisado</option>
                </select>
            </div>

        </div>
    </div>

    <div class="table-card">
        <h3 class="table-header-title">Listado Completo (@(Model != null ? Model.Count() : 0) registros)</h3>

        <div class="table-responsive">
            <table class="table mb-0" id="tablaAspirantes">
                <thead style="background-color: #F9FAFB;">
                    <tr>
                        <th style="padding:1rem; color:#6B7280; font-size:0.75rem; font-weight:700;">NOMBRE COMPLETO</th>
                        <th style="padding:1rem; color:#6B7280; font-size:0.75rem; font-weight:700;">CIUDAD</th>
                        <th style="padding:1rem; color:#6B7280; font-size:0.75rem; font-weight:700;">PROGRAMA DE INTERÉS</th>
                        <th style="padding:1rem; color:#6B7280; font-size:0.75rem; font-weight:700;">ESTADO</th>
                        <th style="padding:1rem; color:#6B7280; font-size:0.75rem; font-weight:700; text-align:right;">ACCIONES</th>
                    </tr>
                </thead>
                <tbody id="cuerpoAspirantes">
                    @if (Model != null)
                    {
                        @foreach (var item in Model)
                        {
                            <tr style="border-bottom: 1px solid #F3F4F6;">
                                <td style="padding:1rem; vertical-align:middle; font-weight:500;">@item.nombreasp @item.apellidoasp</td>
                                <td style="padding:1rem; vertical-align:middle;">@item.ciudadasp</td>
                                <td style="padding:1rem; vertical-align:middle;">@item.programainteres</td>
                                <td style="padding:1rem; vertical-align:middle;">@item.estadoasp</td>
                                <td style="padding:1rem; vertical-align:middle; text-align:right;">
                                    <a asp-action="DetailsAspirantes" asp-route-id="@item.idasp"
                                       style="color:#D91016; border:1px solid #E5E7EB; padding:5px 10px; border-radius:4px; text-decoration:none; font-size:0.85rem; font-weight:600;">
                                        Ver Detalles
                                    </a>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
<!--Filtro de busqueda-->
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            lucide.createIcons();

            const filtroTexto = document.getElementById('filtroTexto');
            const filtroCampo = document.getElementById('filtroCampo');
            const filtroEstado = document.getElementById('filtroEstado');
            const tabla = document.getElementById('cuerpoAspirantes');

            function aplicarFiltro() {
                const texto = (filtroTexto.value || '').toLowerCase().trim();
                const programa = (filtroCampo.value || '').toLowerCase().trim();
                const estado = (filtroEstado.value || '').toLowerCase().trim();

                const filas = tabla.getElementsByTagName('tr');

                for (const fila of filas) {
                    if (fila.cells.length >= 4) {
                        const tNombre = fila.cells[0].textContent.toLowerCase();
                        const tCiudad = fila.cells[1].textContent.toLowerCase();
                        const tProg = fila.cells[2].textContent.toLowerCase();
                        const tEstadoAsp = fila.cells[3].textContent.toLowerCase();

                        // 1) Filtro texto (busca en nombre/ciudad/programa/estado)
                        const cumpleTexto = !texto || (
                            tNombre.includes(texto) ||
                            tCiudad.includes(texto) ||
                            tProg.includes(texto) ||
                            tEstadoAsp.includes(texto)
                        );

                        // 2) Filtro programa
                        const cumplePrograma = !programa || tProg.includes(programa);

                        // 3) Filtro estado
                        const cumpleEstado = !estado || tEstadoAsp.includes(estado);

                        fila.style.display = (cumpleTexto && cumplePrograma && cumpleEstado) ? '' : 'none';
                    }
                }
            }

            filtroTexto.addEventListener('keyup', aplicarFiltro);
            filtroCampo.addEventListener('change', aplicarFiltro);
            filtroEstado.addEventListener('change', aplicarFiltro);
        });
    </script>
}
