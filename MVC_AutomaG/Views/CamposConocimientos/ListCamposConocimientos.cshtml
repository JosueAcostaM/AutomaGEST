@model IEnumerable<Modelos_AutomaG.CamposConocimiento>

@{
    ViewData["Title"] = "Campos de Conocimiento";
}

<link rel="stylesheet" href="~/css/campos-lista.css" asp-append-version="true" />

@section Breadcrumb {
    <li class="breadcrumb-item">
        <a asp-controller="Home" asp-action="Index">Inicio</a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">
        Campos de conocimientos
    </li>
}
@if (User.IsInRole("Super Administrador"))
                    {
<div class="aspirantes-page" style="margin-top: 20px; padding: 2rem;">
    <div class="page-heading">
        <h1 class="page-title">Campos de Conocimiento</h1>
        <p class="page-subtitle">Gestión de áreas académicas y códigos</p>
    </div>

    <div class="table-card">
        <div class="card-header-bar">
            <h3 class="card-title">Listado Actual (@(Model != null ? Model.Count() : 0))</h3>
        </div>

        <div style="overflow-x: auto;">
            <table class="campos-table" id="tablaCampos">
                <thead>
                    <tr>
                        <th style="width: 40%;">NOMBRE</th>
                        <th style="width: 20%;">CÓDIGO</th>
                        <th style="width: 20%;">ESTADO</th>
                        <th style="width: 20%; text-align: center;">ACCIONES</th>
                    </tr>
                </thead>
                <tbody id="cuerpoCampos">
                    @if (Model != null)
                    {
                        @foreach (var item in Model)
                        {
                            <tr data-id-row="@item.idcam">
                                <td style="font-weight: 500;">@item.nombrecam</td>
                                <td style="color: #6B7280;">@item.codigocam</td>
                                <td>
                                    <span style="background:#EFF6FF; color:#1D4ED8; padding:2px 8px; border-radius:12px; font-size:0.8rem; font-weight:600;">
                                        @item.estadocam
                                    </span>
                                </td>
                                <td style="text-align: center;">
                                    <div style="display:flex; justify-content:center; gap:8px;">
                                        <a asp-action="DetailsCamposConocimientos" asp-route-id="@item.idcam" class="btn-action">
                                            Ver Detalles
                                        </a>
                                        @if(User.IsInRole("Super Administrador")){
                                        <button type="button" class="btn-action" style="color:#DC2626; border-color:#FECACA; background:#FEF2F2;" onclick="eliminarCampo('@item.idcam')">
                                            <i data-lucide="trash-2" style="width:14px; margin-right:4px;"></i> Eliminar
                                        </button>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
}
@section Scripts {
    <script>
        // Inicializar iconos al cargar
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

        // Función eliminar
        window.eliminarCampo = function(id) {
            if(!confirm('¿Seguro que quieres eliminar este campo?')) return;

            fetch(`https://localhost:7166/api/CamposConocimientos/${id}`, { method: 'DELETE' })
                .then(r => {
                    if (!r.ok) throw new Error('Error al eliminar');
                    return r;
                })
                .then(() => {
                    // Recargar la tabla
                    fetch('https://localhost:7166/api/CamposConocimientos')
                        .then(r => r.json())
                        .then(data => {
                            const cuerpo = document.getElementById('cuerpoCampos');
                            cuerpo.innerHTML = '';

                            data.forEach(item => {
                                const row = document.createElement('tr');
                                row.setAttribute('data-id-row', item.idcam);

                                // HTML generado dinámicamente con estilos
                                row.innerHTML = `
                                    <td style="font-weight: 500; padding: 1rem 1.5rem; border-bottom: 1px solid #F3F4F6; vertical-align: middle;">${item.nombrecam}</td>
                                    <td style="color: #6B7280; padding: 1rem 1.5rem; border-bottom: 1px solid #F3F4F6; vertical-align: middle;">${item.codigocam}</td>
                                    <td style="padding: 1rem 1.5rem; border-bottom: 1px solid #F3F4F6; vertical-align: middle;">
                                        <span style="background:#EFF6FF; color:#1D4ED8; padding:2px 8px; border-radius:12px; font-size:0.8rem; font-weight:600;">
                                            ${item.estadocam}
                                        </span>
                                    </td>
                                    <td style="text-align: center; padding: 1rem 1.5rem; border-bottom: 1px solid #F3F4F6; vertical-align: middle;">
                                        <div style="display:flex; justify-content:center; gap:8px;">
                                            <a href="/CamposConocimientos/DetailsCamposConocimientos/${item.idcam}" class="btn-action">
                                                Ver Detalles
                                            </a>
                                            <button type="button"
                                                    class="btn-action"
                                                    style="color:#DC2626; border-color:#FECACA; background:#FEF2F2;"
                                                    onclick="eliminarCampo('${item.idcam}')">
                                                <i data-lucide="trash-2" style="width:14px; margin-right:4px;"></i> Eliminar
                                            </button>
                                        </div>
                                    </td>
                                `;
                                cuerpo.appendChild(row);
                            });

                            // Reactivar iconos
                            lucide.createIcons();
                        });
                })
                .catch(err => {
                    console.error(err);
                    alert('No se pudo eliminar el campo');
                });
        }
    </script>
}